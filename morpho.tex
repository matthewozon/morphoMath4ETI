\documentclass[10pt,a4paper]{article}
\usepackage[a4paper]{geometry}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{makeidx}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{color}
\usepackage{import}

\usepackage{epstopdf}

\title{Les exemples du cours}
\author{Matthew OZON} %, \href{mailto:matthew.ozon@cpe.fr}{matthew.ozon@cpe.fr}
\date{\today}

%begining of the document
\begin{document}
\maketitle

\section{Histoire}

\section{Les op\'{e}rateurs : resum\'{e}es}

\subsection{Translation et transpos\'{e}e d'ensemble}
\paragraph{Translation} L'op\'{e}ration la plus basique entre un ensemble $X$ et un vecteur $B$ que l'on note $X_b$: 
\begin{displaymath}
	X_b = \{x+b|x\in X\}
\end{displaymath}

\paragraph{Transpos\'{e}}
Operation qui transforme tout point en son ``opos\'{e}'', relativement \'{a} une origine. Pour un ensemble $X$, on note $X^t$ son transpos\'{e} qui est d\'{e}fini par : 
\begin{displaymath}
	X^t = \{-x | x\in X\}
\end{displaymath}

\subsection{addition et soustraction de Minkowski : les op\'{e}rateurs de dilatation et d'\'{e}rosion}

L'addition et la soustraction de Minkowski sont d\'{e}finit comme suit pour deux ensembles $X$ et $B$ :

\begin{align*}	
	X\oplus B &= \{x+b | x\in X, b\in B\} = \cup\{X_b | b\in B\} 	\\
	X\ominus B &= \{x | B_{-x}\subseteq X\} = \cap\{X_b | b\in B\}
\end{align*}

et les op\'{e}rateurs de dilatation et d'\'{e}rosion sont :
\begin{align*}	
	D_{B}\left(X\right) &= X\oplus B^t	\\
	E_{B}\left(X\right) &= X\ominus B^t
\end{align*}


Quelques propri\'{e}t\'{e}s int\^{e}ressantes de la dilatation et de l'\'{e}rosion : 
\begin{itemize}
	\item extensivit\'{e} : $E_B\left(X\right) \subseteq X \subseteq D_B\left(X\right)$ 
	\item croissance : $X\subset Y \Rightarrow E_B\left(X\right) \subset E_B\left(Y\right) \text{ et } D_B\left(X\right) \subset D_B\left(Y\right)$
	\item distributivit\'{e} : $E_B\left(X\cap Y\right) = E_B\left(X\right) \cap E_B\left(Y\right)$ et $D_B\left(X\cup Y\right) = D_B\left(X\right) \cup D_B\left(Y\right)$
	\item connexit\'{e} : non pr\'{e}serv\'{e}e par les deux op\'{e}rateurs.
	\item composition : $D_{B_2}\left(D_{B1}\left(X\right)\right) = D_{D_{B_{2}^{t}\left(B_1\right)}}\left(X\right)$ et  $E_{B_2}\left(E_{B1}\left(X\right)\right) = E_{D_{B_{2}^{t}\left(B_1\right)}}\left(X\right)$ 
	\item dualit\'{e} : $ E_B\left(X\right) = \overline{ D_B\left(\overline{X}\right)}$
\end{itemize}


\section{Ouverture, fermeture, squel\'{e}tisation}

Les op\'{e}rateurs d'ouverture $\mathcal{O}$, de fermeture $\mathcal{F}$ et de sequ\'{e}letisation $\mathcal{S}$ sont respectivement d\'{e}fini comme suit : 

\begin{align*}	
	X\circ B &=  D_{B^t}\left(E_{B}\left(X\right)\right) \\
	X\bullet B &= E_{B^t}\left(D_{B}\left(X\right)\right) \\
\end{align*}


Quelques propri\'{e}t\'{e}s de l'ouverture et de la fermeture
\begin{itemize}
	\item croissance : $X\subset Y \Rightarrow X\bullet B \subset Y\bullet B \text{ et } X\circ B \subset Y\circ B$
	\item idempotence : $\left( X\bullet B \right) \bullet B = X\bullet B $ et $\left( X \circ B \right) \circ B = X\circ B $
	\item dualit\'{e} : $ X\bullet B = \overline{ \overline{X}\circ B}$ et $ X\circ B = \overline{ \overline{X}\bullet B}$
\end{itemize}

Pour d\'{e}montrer ces propri\'{e}t\'{e}s, il suffit de les ecrire avec les definitions... ce qui peut etre un exercice.

Voici quelques exemples d'applications d'ouverture et de fermeture, figures~\ref{piece} et \ref{pieceOF}.


\begin{figure}[h]
\hspace{-0.2\textwidth}\input{data/tex/piece.tex}
	\caption{Image d'origine en haut, image de la norme du gradient au milieu et, en bas, image binaire des contours (seuillage de la norme du gradient \`{a} 100)}
	\label{piece}
\end{figure}

\begin{figure}[h]
\hspace{-0.2\textwidth}\input{data/tex/pieceOF.tex}
\caption{En haut) image ouverte, en bas) image ferm\'{e}e}
\label{pieceOF}
\end{figure}


\clearpage

\paragraph{Exemple d'utilisation pour du d\'{e}bruitage} Dans le cas ou une image est compos\'{e}e de larges morceaux de m\^{e}me niveau (0 ou 1) avec quelques pixel alt\`{e}res, il est possible de faire du d\'{e}bruitage a partir des op\'{e}rations d'ouverture et de fermeture. Voici un exemple sur les figures~\ref{debruitageOrigine} montrant image d'origine et image bruit\'{e}e, figure~\ref{debruitageSteps} gauche)  la premi\`{e}re \'{e}tape enlevant le bruit du fond (noir) et figure~\ref{debruitageSteps} droite) l'\'{e}tape d\'{e}bruitant l'objet (blanc).

\begin{figure}[h]
\hspace{-0.2\textwidth}\input{data/tex/debruitageOrigine.tex}
\vspace{-40mm}
	\caption{Image d'origine \`{a} gauche, et, \`{a} droite, image bruit\'{e}e.}
	\label{debruitageOrigine}
\end{figure}

\begin{figure}[h]
\hspace{-0.2\textwidth}\input{data/tex/debruitageSteps.tex}
\vspace{-40mm}
	\caption{\'{E}tapes du processus de filtrage : gauche) image apr\`{e}s ouverture, droite) image apr\`{e}s ouverture puis fermeture}
	\label{debruitageSteps}
\end{figure}

\paragraph{Remarque} On peut remarquer que le filtrage n'est pas vraiment parfait, m\^{e}me si le bruit et compl\`{e}tement parti. En effet, les objets ont \'{e}t\'{e}s déform\'{e}s pendant les \'{e}tapes.

\clearpage


\subsection{Hit or Miss Transform}

Ou sous son nom fran\c{}ais, la transform\'{e}e tout-ou-rien. Elle sert \`{a} extraire des motifs d'une image, par exemple les points qui sont \`{a} la fois dans l'objet et qui n'ont aucun voisin (il faut pr\'{e}ciser le voisinage utilis\'{e}). Formellement, on la d\'{e}finit comme suit : 
\begin{displaymath}
	X\odot B = E_{B{\text{fg}}}\left(X\right) \cap E_{B{\text{bg}}}\left(\overline{X}\right)
\end{displaymath}
avec $B = \left(B{\text{fg}},B{\text{bg}}\right)$, ou $B{\text{fg}}$ repr\'{e}sente l'op\'{e}ration sur l'objet et $B{\text{bg}}$ l'op\'{e}ration sur le fond. Les deux \'{e}l\'{e}ments structurants doivent satisfaire $B{\text{fg}}\cap B{\text{bg}} = \varnothing$

\subsubsection{Applications}

\paragraph{Points isol\'{e}s}
Au sens du 4-voisinage, des points isol\'{e}s sont des points qui sont dans l’objet et qui n'ont pas de voisins sur le 4-voisinage, ainsi, on d\'{e}finit les \'{e}l\'{e}ments structurants : 


\begin{displaymath}
B_{\text{fg}} = 
\begin{array}{|c|c|c|}
	\hline 0  & 0  & 0   \\
	\hline 0  & 1  & 0  \\
	\hline 0  & 0  & 0  \\
	\hline
\end{array}
\text{ et } 
B_{\text{bg}} = 
	\begin{array}{|c|c|c|}
	 \hline 0  & 1  & 0   \\
	 \hline 1  & 0  & 1  \\
	 \hline 0  & 1  & 0  \\
	\hline
	\end{array}
\end{displaymath}


on verifie bien que $B{\text{fg}}\cap B{\text{bg}} = \varnothing$. Voici le r\'{e}sultats figure~\ref{points} sur laquelle les points isol\'{e}s figurent en rouge, pour une image de contour binaris\'{e}e (fig.~\ref{piece}).
\begin{figure}[h]
\hspace{0.05\textwidth}\scalebox{0.66}{\input{data/tex/points.tex}}
\vspace{-25mm}
	\caption{Les points rouge sont isol\'{e}s au sens du 4-voisinage.}
	\label{points}
\end{figure}
\clearpage

\paragraph{Extremit\'{e}s} 
La d\'{e}tection des extr\'{e}mit\'{e}s est plus subtile car il faut consid\'{e}rer plusieurs cas. Ici, on cherche \`{a}{  d\'{e}tecter les extr\'{e}mit\'{e}s au sens du 8-voisinage. Il faut extraire tout les points qui sont dans l'objet et qui n'ont qu'un seul voisin. Pour cela, on va faire plusieurs extractions et le r\'{e}sultat final sera l'union de touts les r\'{e}sultats. Figure~\ref{wodka} montre le r\'{e}sultat de cette op\'{e}ration en rouge sur l'image (les points ont \'{e}t\'{e}s dilat\'{e}s pour plus de claret\'{e}).

Voici les masque utilises : 
\begin{displaymath}
B_{\text{fg}} = 
\begin{array}{|c|c|c|}
	\hline 0  & 0  & 0   \\
	\hline 0  & 1  & 0  \\
	\hline 0  & 0  & 0  \\
	\hline
\end{array}
\end{displaymath}
et
\begin{displaymath}
B_{\text{bg}} \in\left\{ 
	\begin{array}{|c|c|c|}
	 \hline 1  & 0  & 1   \\
	 \hline 1  & 0  & 1  \\
	 \hline 1  & 1  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 1  & 1   \\
	 \hline 1  & 0  & 1  \\
	 \hline 1  & 1  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  & 1   \\
	 \hline 0  & 0  & 1  \\
	 \hline 1  & 1  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  & 1   \\
	 \hline 1  & 0  & 1  \\
	 \hline 0  & 1  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  & 1   \\
	 \hline 1  & 0  & 1  \\
	 \hline 1  & 0  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  & 1   \\
	 \hline 1  & 0  & 1  \\
	 \hline 1  & 1  & 0  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  & 1   \\
	 \hline 1  & 0  & 0  \\
	 \hline 1  & 1  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  & 0   \\
	 \hline 1  & 0  & 1  \\
	 \hline 1  & 1  & 1  \\
	\hline
	\end{array}
\right\}
\end{displaymath}

\begin{figure}[h]
\hspace{-0.0\textwidth}\scalebox{0.66}{\input{data/tex/wodka.tex}}
\vspace{-10mm}
	\caption{Les points rouge sont les extr\'{e}mit\'{e}s au sens du 8-voisinage.}
	\label{wodka}
\end{figure}
\clearpage

\paragraph{D\'{e}tection de contour et comparaison}
On introduit la notion de gradient morphologique $G_B$comme la diff\'{e}rence entre la dilatation et l'\'{e}rosion d'une image par un \'{e}l\'{e}ment structurant B.
\begin{displaymath}
G_B\left(X\right) = D_B\left(X\right)\backslash E_B\left(X\right) \text{ avec, dans notre exemple : }
B = 
\begin{array}{|c|c|c|}
	\hline 0  & 1  & 0   \\
	\hline 1  & 1  & 1  \\
	\hline 0  & 1  & 0  \\
	\hline
\end{array}
\end{displaymath}

En suivant la m\^{e}me logique qu'au paragraphe pr\'{e}c\'{e}dent, on d\'{e}finit aussi les pairs structurantes pour la d\'{e}tection de contours par transformation Tout-ou-Rien : 
\begin{displaymath}
B_{\text{fg}} = 
\begin{array}{|c|c|c|}
	\hline 0  & 0  & 0   \\
	\hline 0  & 1  & 0  \\
	\hline 0  & 0  & 0  \\
	\hline
\end{array}
\end{displaymath}
et
\begin{displaymath}
B_{\text{bg}} \in\left\{ 
	\begin{array}{|c|c|c|}
	 \hline 0  & 1  & 0   \\
	 \hline 0  & 0  & 0  \\
	 \hline 0  & 0  & 0  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 0  & 0   \\
	 \hline 1  & 0  & 0  \\
	 \hline 0  & 0  & 0  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 0  & 0   \\
	 \hline 0  & 0  & 0  \\
	 \hline 0  & 1  & 0  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 0  & 0   \\
	 \hline 0  & 0  & 1  \\
	 \hline 0  & 0  & 0  \\
	\hline
	\end{array}
\right\}
\end{displaymath}

Figure~\ref{gradient} et figure~\ref{contour} repr\'{e}sentent les r\'{e}sultats respectifs du gradient morphologique et de la d\'{e}tection par transform\'{e}e Tout-ou-Rien en pixel rouge.

\begin{figure}[h]
\hspace{-0.0\textwidth}\scalebox{0.66}{\input{data/tex/gradient.tex}}
\vspace{-10mm}
	\caption{Les points rouges sont les contours au sens du gradient morphologique}
	\label{gradient}
\end{figure}

\begin{figure}[h]
\hspace{-0.0\textwidth}\scalebox{0.66}{\input{data/tex/contour.tex}}
\vspace{-10mm}
	\caption{Les points rouges sont les contours au sens de la transformee Tout-ou-Rien}
	\label{contour}
\end{figure}

\clearpage

\subsection{Lien entre dilatation et carte de distance}
La dilatation d'une image a d\'{e}j\`{a} \'{e}t\'{e} introduite, il ne reste que la notion de carte de distance. C'est tout simplement une image qui en chaque point donne la distance \~{a} l'objet le plus proche. Elle est impl\'{e}ment\'{e}e dans l'op\'{e}rateur \textit{bwdist} sous \textit{octave}

La figure~\ref{distanceAndDilatation} montre le r\'{e}sultat d'une dilatation par la m\'{e}thode utilisant la somme de Minkowski (la ligne du haut) et le seuillage de la carte de distance.

\begin{figure}[h]
\hspace{-0.0\textwidth}\scalebox{0.66}{\input{data/tex/distanceAndDilatation.tex}}
\vspace{-10mm}
	\caption{}
	\label{distanceAndDilatation}
\end{figure}













%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Divers applications}

\subsection{Application de l'\'{e}rosion : d\'{e}tection de la p\'{e}riode d'un motif}
En choisissant  judicieusement un \'{e}l\'{e}ment structurant, on peut utiliser l'\'{e}rosion pour d\'{e}tecter la p\'{e}riode d'un motif dans une image. Par exemple pour une image comme celle de la figure~\ref{periode}, on peut utiliser un \'{e}l\'{e}ment s structurant ligne $B_{\text{ligne}}^{\left(n\right)}$ tel que : 
\begin{displaymath}
B_{\text{ligne}}^{\left(n\right)} = \begin{array}{|c|}
	\hline 1  \\
	\hline
\end{array}
\underset{\text{n z\'{e}ros}}{\underbrace{
\begin{array}{ccc}
	\hline  0 & \ldots & 0   \\
	\hline
\end{array}}}
\begin{array}{|c|}
	\hline 1  \\
	\hline
\end{array}
\end{displaymath}
et en utilisant une formule de covariance comme : 
\begin{displaymath}
	C_{B_{\text{ligne}}^{\left(n\right)}}\left(X\right)= \frac{1}{\underset{\text{pixel }\left(i,j\right)}{\sum} X\left(i,j\right) } \underset{\text{pixel }\left(i,j\right)}{\sum} E_{B_{\text{ligne}}^{\left(n\right)}}\left(X\right)\left(i,j\right) 
\end{displaymath}
\begin{figure}[h]
\scalebox{0.66}{\input{data/tex/periode.tex}}
%\includegraphics[width=0.45\textwidth]{data/pics/rayure.png}
\caption{Image de rayure verticale a droite et fonction de corr\'{e}lation (morphologique) entre l'image originale et son \'{e}rod\'{e}e par une pair de point distante de n}
\label{periode}
\end{figure}
\begin{figure}[h]
	\centering
\scalebox{0.45}{\input{data/tex/erosionSrc.tex}}\scalebox{0.45}{\input{data/tex/erosion.tex}}
	\caption{Image d'origine a gauche et r\'{e}sultat de l’\'{e}rosion par la boule unit\'{e} au sens du 4-voisinage \`{a} droite}
	\label{erosion}
\end{figure}

\begin{figure}[h]
	\centering
	\scalebox{0.45}{\input{data/tex/dilatationSrc.tex}}\scalebox{0.45}{\input{data/tex/dilatation.tex}}
	\caption{Image d'origine a gauche et r\'{e}sultat de la dilatation par la boule unit\'{e} au sens du 4-voisinage \`{a} droite}
	\label{dilatation}
\end{figure}
\clearpage


\subsection{granulom\'{e}trie}
En morphologie, la granulom\'{e}trie est la mesure de granularit\'{e} qui consiste \`{a} d\'{e}nombrer les grains en fonction de leur tailles. Une approche possible est ``d\'{e}bruiter'' l'image $X$ par des \'{e}l\'{e}ments structurant $B_n$ de plus en plus grand et de compter le nombre de pixels restants. Plus formellement, la fonction granulometrique peut se definir comme l'application $\gamma_n$ pour $n\in\mathbb{n}$ telle que
\begin{align*}
	\gamma_n : \mathfrak{X} &\longrightarrow \mathbb{N}\\
						X     & \longmapsto \left| X \circ B_n \right|
\end{align*}
ou $\left|  A \right|$ denote le cardinal de l'ensemble $A$ et $B_n = \underset{\text{n fois}}{\underbrace{B \oplus\ldots\oplus B}}$. Par convention, $B_0$ est le singleton $\{1\}$ centr\'{e} sur lui m\^{e}me.
On remarque que cette mesure depend du l'\'{e}l\'{e}ment structurant utilis\'{e}.

\subsection{Comptage de connexit\'{e}}
On consid\`{e}re le graphe $\mathcal{G}=\left(\mathcal{X},\mathcal{E}\right)$ avec $\mathcal{X}$ un ensemble de points et $\mathcal{E}$ un ensemble d'ar\`{e}tes (paires de points).
Le nombre de connexit\'{e} $N_c$ du graphe $\mathcal{G}$  est d\'{e}finit comme :
\begin{displaymath}
	N_c = N_s - N_a + N_f
\end{displaymath}
ou $N_s$ est le nombre de sommet ($\left|\mathcal{X}\right|$), $N_a$ le nombre d'ar\^{e}tes ($\left|\mathcal{E}\right|$) et $N_f$ le nombre de faces de $\mathcal{G}$. 

Une face $f$ du graphe $G$ est une cycle de longueur au moins \'{e}gale \`{a} 3 et ne contenant aucun sommet ou ar\`{e}te en son int\'{e}rieur. On appelle cycle une cha\^{i}ne ferm\'{e}e et simple (constitu\'{e}e d'ar\^{e}tes distinctes).

\paragraph{Avec Hit-or-Miss?} Oui il y a une possibilit\'{e}. Il suffit de consid\'{e}rer l'image binaire comme un graphe dont les sommets sont les pixels. En analisant la maille \'{e}l\'{e}mentaire $\begin{array}{|c|c|}  \hline ~  & ~   \\  \hline ~  & ~   \\ \hline \end{array}$, on peut montrer que 

\begin{displaymath}
	N_c =  \left|X \odot\left\{ 
	\begin{array}{|c|c|c|}
	 \hline 1  & 0  \\
	 \hline 0  & 0  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 1  \\
	 \hline 1  & 1  \\
	\hline
	\end{array}
\right\}\right|+
\left|X \odot\left\{ 
	\begin{array}{|c|c|c|}
	 \hline 1  & 0  \\
	 \hline 0  & 1  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 1  \\
	 \hline 1  & 0  \\
	\hline
	\end{array}
\right\}\right|-
\left|X \odot\left\{ 
	\begin{array}{|c|c|c|}
	 \hline 1  & 1  \\
	 \hline 1  & 0  \\
	\hline
	\end{array},
	\begin{array}{|c|c|c|}
	 \hline 0  & 0  \\
	 \hline 0  & 1  \\
	\hline
	\end{array}
\right\}\right|
\end{displaymath}
\clearpage
\subsection{Squelette}
\begin{displaymath}
	\mathcal{S}_{B}\left(X\right) = \underset{n\in \mathbb{N}}{\cup} \left(E_{B_n}\left(X\right) \backslash \left(E_{B_n}\left(X\right)\right)\circ B \right)
\end{displaymath}
o\`{u} $B_n =\underset{n \text{ fois}}{\underbrace{B\oplus\ldots\oplus B}}$ et par convention $B_0$ est l'ensemble de un pixel \`{a} l'origine. En pratique, on ne fait pas tendre $n$ vers $+\infty$, mais on s'arr\^{e}te quand on atteint idempotence. 

\begin{figure}[h!]
\hspace{-0.2\textwidth}\input{data/tex/rectSkel.tex}
\vspace{-40mm}
	\caption{Image d'origine, un rectangle, \`{a} gauche, et, \`{a} droite, le squelette.}
	\label{rectSkel}
\end{figure}
\begin{figure}[h]
\hspace{-0.2\textwidth}\input{data/tex/veauSkel.tex}
\vspace{-40mm}
	\caption{Image de veau segment\'{e}e, \`{a} gauche, et, \`{a} droite, le squelette.}
	\label{rectSkel}
\end{figure}

\clearpage

\end{document}





